<vex-page-layout mode="card">

  <vex-secondary-toolbar *ngIf="clientForm.get('companyName').value" [current]="[clientForm.get('companyName').value]">
    <div fxFlex="auto">
      <span style="color:darkgray" *ngIf="clientForm.get('createdDate').value">Date Registered: {{clientForm.get('createdDate').value| date:'dd MMM yyyy' }}</span>
    </div>
  </vex-secondary-toolbar>

  <vex-page-layout-content class="vex-tabs p-0 card" vexContainer>
    <form (ngSubmit)="submit()" [formGroup]="clientForm">
      <mat-tab-group>
        <mat-tab label="Client Details">
          <div class="p-6 ml-8">
            <h3>Client Information</h3>
          </div>
          <mat-divider></mat-divider>
          <div class="p-6">
            <div class="px-6 py-4 border-b" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
              <div fxFlex="auto">
                <div fxLayout="row" fxLayoutAlign="start center">
                  <h2 class="py-2 title m-0">Company Logo</h2>
                </div>
                <div class="px-6 py-4" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
                  <div fxFlex="200px">
                    <img [src]="croppedImage" style="width:200px;height:200px">
                    <image-cropper
                      [imageChangedEvent]="imageChangedEvent"
                      [maintainAspectRatio]="true"
                      [aspectRatio]="1 / 1"
                      format="png"
                      #cropper
                      (imageCropped)="imageCropped($event)"
                    ></image-cropper>
                    <label class="file-label inline-block">
                      <input
                        class="file-input"
                        type="file"
                        accept=".png,.jpg,.jpeg"
                        name="file"
                        #fileInput
                        (change)="fileChangeEvent($event)"
                        style="opacity: 0;line-height: 0; width: 20px;"
                      />
                      <span *ngIf="!isUploading" class="file-label mat-stroked-button" color="secondary">
                        {{ btnTxt }}
                      </span>
                      <span class="file-name block">
                        {{ fileName }}
                      </span>
                      <button *ngIf="isUploading" type="button" mat-button style="margin-left: 128px;background: #5c77ff;color: white;" color="primary" (click)="onUpload()">Upload</button>
                    </label>
                    <button *ngIf="!isUploading && picRemove" type="button" mat-stroked-button mat-button color="accent" (click)="removePicture('remove')">Remove</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="px-6 py-4 border-b" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
              <div fxFlex="50">
                <div fxLayout="row" fxLayoutAlign="start center">
                  <h2 class="py-2 title m-0">Company Address</h2>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Company Address</mat-label>
                      <input formControlName="companyAddress" matInput >
                    </mat-form-field>
                  </div>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Company Phone Number</mat-label>
                      <input formControlName="companyPhoneNumber"  pattern="[+0-9]*" minlength="10" maxlength="14" onkeypress="return event.charCode >= 48 && event.charCode <= 57 || event.charCode == 43" matInput >
                    </mat-form-field>
                  </div>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Address Line 1</mat-label>
                      <input formControlName="addressLine1"  matInput >
                    </mat-form-field>
                  </div>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Town / City</mat-label>
                      <input formControlName="city" matInput >
                    </mat-form-field>
                  </div>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Postcode</mat-label>
                      <input formControlName="postcode"  matInput >
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
            <div class="px-6 py-4 border-b" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
              <div fxFlex="auto">
                <div fxLayout="row" fxLayoutAlign="start center">
                  <h2 class="py-2 title m-0">Business Information</h2>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Business Name</mat-label>
                      <input formControlName="companyName" matInput >
                    </mat-form-field>
                    <mat-form-field fxFlex="auto">
                      <mat-label>Phone Number</mat-label>
                      <input formControlName="phoneNumber"  pattern="[+0-9]*" minlength="10" maxlength="14" onkeypress="return event.charCode >= 48 && event.charCode <= 57 || event.charCode == 43" matInput >
                    </mat-form-field>
                    <mat-form-field fxFlex="auto">
                      <mat-label>VAT Registration Number</mat-label>
                      <input formControlName="VATNumber" matInput >
                    </mat-form-field>
                  </div>
                </div>
                <div fxLayout="column">
                  <div fxLayout="row"  fxLayout.lt-sm="column" fxLayoutGap="16px" fxLayoutGap.lt-sm="0">
                    <mat-form-field fxFlex="auto">
                      <mat-label>Company Registration Number</mat-label>
                      <input formControlName="companyRegNumber" matInput >
                    </mat-form-field>
                    <mat-form-field fxFlex="auto">
                      <mat-label>Company Email Address</mat-label>
                      <input formControlName="emailAddress"  matInput >
                    </mat-form-field>
                    <mat-form-field fxFlex="auto">
                      <mat-label>Email Address Accounts Team</mat-label>
                      <input formControlName="emailAddressAccountsTeam"  matInput >
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="8px">
              <button mat-button (click)="cancelBtn()"type="button">CANCEL</button>
              <button color="primary" mat-raised-button type="submit">SAVE CHANGES</button>
            </div>
          </div>
        </mat-tab>
        <mat-tab label="Sub Accounts">
          <div class="p-6">
            <div class="p-6 ml-8 justify-between">
              <h3>Sub Accounts</h3>
              <button (click)="createCustomer()"
                class="ml-4"
                color="primary"
                fxFlex="none"
                mat-raised-button
                matTooltip="Add Sub Account"
                type="button">
                Create New User
              </button>
            </div>
            <mat-divider></mat-divider>
            <div class="py-4">
              <table @stagger [dataSource]="subAccountsDataSource" class="w-full" mat-table matSort>
                <!-- Text Columns -->
                <ng-container *ngFor="let column of subAccountsColumns; trackBy: trackByProperty">
                  <ng-container *ngIf="column.type === 'text'" [matColumnDef]="column.property">
                    <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> {{ column.label }}</th>
                    <td *matCellDef="let row" [ngClass]="column.cssClasses" mat-cell>{{ row[column.property] }}</td>
                  </ng-container>
                </ng-container>

                <!-- Action Column -->
                <ng-container matColumnDef="actions">
                  <th *matHeaderCellDef mat-header-cell mat-sort-header>ACTIONS</th>
                  <td *matCellDef="let row" class="w-10 text-secondary" mat-cell>
                    <button (click)="$event.stopPropagation()"
                      [matMenuTriggerData]="{ customer: row }"
                      [matMenuTriggerFor]="actionsMenu"
                      mat-icon-button
                      type="button">
                      <mat-icon [icIcon]="icMoreHoriz"></mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr *matHeaderRowDef="visibleAccountsColumns" mat-header-row></tr>
                <tr (click)="updateCustomer(row)"
                  *matRowDef="let row; columns: visibleAccountsColumns;"
                  @fadeInUp
                  class="hover:bg-hover trans-ease-out cursor-pointer"
                  mat-row>
                </tr>
              </table>
              <mat-paginator [pageSizeOptions]="pageSizeOptions" [pageSize]="pageSize" class="sticky left-0"></mat-paginator>
            </div>
          </div>
        </mat-tab>
        <mat-tab label="Custom Rates">
          <div class="p-6">
            <ng-template matTabContent>
              <div class="p-6 ml-8">
                <h3>Custom Rates</h3>
                <p>You'll be able to manually override the default pay and charge rates for this client.<br/> If You have a field blank, it will use the default rate as set in Admin settings.</p>
              </div>
              <mat-divider></mat-divider>
              <mat-tab-group [(selectedIndex)]="innerSelectedTabIndex" (selectedTabChange)="onTabChanged($event);">
                <mat-tab label="Housekeeping">
                  <div class="p-6">
                    <div class="py-4">
                      <table @stagger [dataSource]="dataSource" class="w-full" mat-table matSort>

                        <ng-container matColumnDef="role">
                          <th *matHeaderCellDef mat-header-cell>Role</th>
                          <td mat-cell *matCellDef="let element">{{element.role}}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="payrateU25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Pay Rate (Under 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('payrateU25', $event, element)">
                              {{element.payrateU25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="chargerateU25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Charge Rate (Under 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('chargerateU25', $event, element)">
                              {{element.chargerateU25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="payrateO25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Pay Rate (Over 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('payrateO25', $event, element)">
                              {{element.payrateO25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="chargerateO25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Charge Rate (Over 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('chargerateO25', $event, element)">
                              {{element.chargerateO25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
                        <tr *matRowDef="let row; columns: visibleColumns;" @fadeInUp class="hover:bg-hover trans-ease-out cursor-pointer" mat-row></tr>
                      </table>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="8px">
                      <button mat-button (click)="cancelBtn()"type="button">CANCEL</button>
                      <button color="primary" mat-raised-button type="button" (click)="save()">Update</button>
                    </div>
                  </div>
                </mat-tab>
                <mat-tab label="Food and Beverage">
                  <div class="p-6">
                    <div class="py-4">
                      <table @stagger [dataSource]="dataSource" class="w-full" mat-table matSort>

                        <ng-container matColumnDef="role">
                          <th *matHeaderCellDef mat-header-cell>Role</th>
                          <td mat-cell *matCellDef="let element">{{element.role}}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="payrateU25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Pay Rate (Under 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('payrateU25', $event, element)">
                              {{element.payrateU25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="chargerateU25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Charge Rate (Under 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('chargerateU25', $event, element)">
                              {{element.chargerateU25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="payrateO25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Pay Rate (Over 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('payrateO25', $event, element)">
                              {{element.payrateO25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="chargerateO25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Charge Rate (Over 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('chargerateO25', $event, element)">
                              {{element.chargerateO25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
                        <tr *matRowDef="let row; columns: visibleColumns;" @fadeInUp class="hover:bg-hover trans-ease-out cursor-pointer" mat-row></tr>
                      </table>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="8px">
                      <button mat-button (click)="cancelBtn()"type="button">CANCEL</button>
                      <button color="primary" mat-raised-button type="button" (click)="save()">Update</button>
                    </div>
                  </div>
                </mat-tab>
                <mat-tab label="Back of House">
                  <div class="p-6">
                    <div class="py-4">
                      <table @stagger [dataSource]="dataSource" class="w-full" mat-table matSort>

                        <ng-container matColumnDef="role">
                          <th *matHeaderCellDef mat-header-cell>Role</th>
                          <td mat-cell *matCellDef="let element">{{element.role}}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="payrateU25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Pay Rate (Under 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('payrateU25', $event, element)">
                              {{element.payrateU25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="chargerateU25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Charge Rate (Under 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('chargerateU25', $event, element)">
                              {{element.chargerateU25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="payrateO25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Pay Rate (Over 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('payrateO25', $event, element)">
                              {{element.payrateO25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="chargerateO25">
                          <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> Charge Rate (Over 25)
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <mat-icon class="currency">£</mat-icon>
                            <div class="inline-block p-2" [attr.contenteditable]="true" (blur)="editCustomRates('chargerateO25', $event, element)">
                              {{element.chargerateO25.toFixed(2)}}
                            </div>
                          </td>
                        </ng-container>

                        <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
                        <tr *matRowDef="let row; columns: visibleColumns;" @fadeInUp class="hover:bg-hover trans-ease-out cursor-pointer" mat-row></tr>
                      </table>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="8px">
                      <button mat-button (click)="cancelBtn()"type="button">CANCEL</button>
                      <button color="primary" mat-raised-button type="button" (click)="save()">Update</button>
                    </div>
                  </div>
                </mat-tab>
              </mat-tab-group>
            </ng-template>
          </div>
        </mat-tab>
      </mat-tab-group>
    </form>
  </vex-page-layout-content>

</vex-page-layout>

<mat-menu #actionsMenu="matMenu" xPosition="before" yPosition="below">
  <ng-template let-customer="customer" matMenuContent>
    <button (click)="updateCustomer(customer)" mat-menu-item>
      <mat-icon [icIcon]="icEdit"></mat-icon>
      <span>Modify</span>
    </button>
    <button (click)="deleteCustomer(customer)" mat-menu-item>
      <mat-icon [icIcon]="icDelete"></mat-icon>
      <span>Delete</span>
    </button>
  </ng-template>
</mat-menu>
